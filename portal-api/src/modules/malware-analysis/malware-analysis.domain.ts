import config from 'config';
import { PortalContext } from '../../model/portal-context';
import { Readable } from 'stream';
import {
  uploadFileToServer,
  uploadStringToServer,
} from './malware-analysis.helper';
const GLIMPS_URL = config.get('malware_analysis.url');

export interface UploadFile {
  file: {
    createReadStream: () => Readable;
    filename: string;
    mimeType: string;
  };
}

export interface AnalyseStringParams {
  string?: string;
  uploadFile?: UploadFile;
}

export const analyseString = async (
  context: PortalContext,
  { string, uploadFile }: AnalyseStringParams
) => {
  const url = `${GLIMPS_URL}/analyses/submit`;

  if (uploadFile?.file) {
    return await uploadFileToServer(url, uploadFile);
  }
  return await uploadStringToServer(url, string);
};
