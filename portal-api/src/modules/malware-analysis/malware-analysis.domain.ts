import { streamToBlob } from '../../utils/processUploadFile';
const GLIMPS_URL = 'http://localhost:8080';
export const analyseString = async ({
  string,
  file,
}: {
  string?: string;
  file?: {
    file: {
      createReadStream: () => NodeJS.ReadableStream;
      filename: string;
      mimeType: string;
    };
  };
}) => {
  if (file.file) {
    const blob = await streamToBlob(
      file.file.createReadStream(),
      file.file.mimeType
    );
    const formData = new FormData();
    formData.append('file', blob, file.file.filename);
    return await fetch(`${GLIMPS_URL}/analyses/submit`, {
      method: 'POST',
      headers: {
        Accept: 'application/json',
      },
      body: formData,
    }).then((response) => response.json());
  }

  return await fetch(`${GLIMPS_URL}/analyses/submit`, {
    method: 'POST',
    headers: {
      Accept: 'application/json',
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ string }),
  }).then((response) => response.json());
};
