import { streamToBlob } from '../../utils/processUploadFile';
import { UploadFile } from './malware-analysis.domain';

export const uploadFileToServer = async (
  url: string,
  uploadFile: UploadFile
) => {
  const blob = await streamToBlob(
    uploadFile.file.createReadStream(),
    uploadFile.file.mimeType
  );
  const formData = new FormData();
  formData.append('file', blob, uploadFile.file.filename);

  const response = await fetch(url, {
    method: 'POST',
    headers: {
      Accept: 'application/json',
    },
    body: formData,
  });

  return response.json();
};

export const uploadStringToServer = async (
  url: string,
  stringData?: string
) => {
  const response = await fetch(url, {
    method: 'POST',
    headers: {
      Accept: 'application/json',
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ string: stringData }),
  });

  return response.json();
};
